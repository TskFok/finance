basePath: /
definitions:
  api.AIChatRequest:
    properties:
      message:
        minLength: 1
        type: string
      model_id:
        type: integer
    required:
    - message
    - model_id
    type: object
  api.AdminCreateExpenseRequest:
    properties:
      amount:
        type: number
      category:
        type: string
      description:
        type: string
      expense_time:
        description: '格式: 2006-01-02 15:04:05'
        type: string
      user_id:
        type: integer
    required:
    - amount
    - category
    - expense_time
    - user_id
    type: object
  api.AdminCreateIncomeRequest:
    properties:
      amount:
        type: number
      income_time:
        description: "2006-01-02 15:04:05"
        type: string
      type:
        type: string
      user_id:
        type: integer
    required:
    - amount
    - income_time
    - type
    - user_id
    type: object
  api.AdminLoginRequest:
    properties:
      password:
        type: string
      username:
        type: string
    required:
    - password
    - username
    type: object
  api.AdminResetPasswordRequest:
    properties:
      new_password:
        minLength: 6
        type: string
      user_id:
        type: integer
    required:
    - new_password
    - user_id
    type: object
  api.AdminUpdateExpenseRequest:
    properties:
      amount:
        type: number
      category:
        type: string
      description:
        type: string
      expense_time:
        description: '格式: 2006-01-02 15:04:05'
        type: string
    type: object
  api.AdminUpdateIncomeRequest:
    properties:
      amount:
        type: number
      income_time:
        type: string
      type:
        type: string
    type: object
  api.AnalysisRequest:
    properties:
      end_time:
        example: "2024-12-31"
        type: string
      model_id:
        type: integer
      start_time:
        example: "2024-01-01"
        type: string
      user_id:
        description: 可选，仅管理员可用，用于筛选指定用户的账单
        example: 1
        type: integer
    required:
    - end_time
    - model_id
    - start_time
    type: object
  api.AppRequestPasswordResetRequest:
    properties:
      email:
        example: test@example.com
        type: string
    required:
    - email
    type: object
  api.AppResetPasswordRequest:
    properties:
      code:
        example: "123456"
        type: string
      email:
        example: test@example.com
        type: string
      new_password:
        example: newpassword123
        minLength: 6
        type: string
    required:
    - code
    - email
    - new_password
    type: object
  api.AppVerifyResetCodeRequest:
    properties:
      code:
        example: "123456"
        type: string
      email:
        example: test@example.com
        type: string
    required:
    - code
    - email
    type: object
  api.CategoryCreateRequest:
    properties:
      color:
        description: '颜色代码，如 #ef4444'
        maxLength: 20
        type: string
      name:
        maxLength: 50
        minLength: 1
        type: string
      sort:
        type: integer
    required:
    - name
    type: object
  api.CategoryUpdateRequest:
    properties:
      color:
        maxLength: 20
        type: string
      name:
        maxLength: 50
        minLength: 1
        type: string
      sort:
        type: integer
    type: object
  api.ChangePasswordRequest:
    properties:
      new_password:
        example: newpassword123
        maxLength: 50
        minLength: 6
        type: string
      old_password:
        example: oldpassword123
        type: string
    required:
    - new_password
    - old_password
    type: object
  api.CreateAIModelRequest:
    properties:
      api_key:
        example: sk-...
        minLength: 1
        type: string
      base_url:
        example: https://api.openai.com/v1
        type: string
      name:
        example: OpenAI GPT-4
        maxLength: 100
        minLength: 1
        type: string
    required:
    - api_key
    - base_url
    - name
    type: object
  api.CreateExpenseRequest:
    properties:
      amount:
        example: 99.99
        type: number
      category:
        example: 餐饮
        type: string
      description:
        example: 午餐
        type: string
      expense_time:
        example: "2024-01-15 12:30:00"
        type: string
    required:
    - amount
    - category
    - expense_time
    type: object
  api.CreateIncomeRequest:
    properties:
      amount:
        example: 5000
        type: number
      income_time:
        example: "2024-01-15 09:00:00"
        type: string
      type:
        example: 工资
        type: string
    required:
    - amount
    - income_time
    - type
    type: object
  api.ImpersonateUserRequest:
    properties:
      user_id:
        type: integer
    required:
    - user_id
    type: object
  api.IncomeCategoryCreateRequest:
    properties:
      color:
        description: '颜色代码，如 #10b981'
        maxLength: 20
        type: string
      name:
        maxLength: 50
        minLength: 1
        type: string
      sort:
        type: integer
    required:
    - name
    type: object
  api.IncomeCategoryUpdateRequest:
    properties:
      color:
        maxLength: 20
        type: string
      name:
        maxLength: 50
        minLength: 1
        type: string
      sort:
        type: integer
    type: object
  api.IncomeExpenseSummaryResponse:
    properties:
      total_expense:
        description: 支出总和
        example: 123.45
        type: number
      total_income:
        description: 收入总和
        example: 5000
        type: number
    type: object
  api.LoginRequest:
    properties:
      password:
        example: password123
        type: string
      username:
        example: testuser
        type: string
    required:
    - password
    - username
    type: object
  api.LoginResponse:
    properties:
      token:
        type: string
      user_info:
        $ref: '#/definitions/models.User'
    type: object
  api.PageResponse:
    properties:
      list: {}
      page:
        type: integer
      page_size:
        type: integer
      total:
        type: integer
    type: object
  api.RegisterRequest:
    properties:
      email:
        example: test@example.com
        type: string
      password:
        example: password123
        maxLength: 50
        minLength: 6
        type: string
      username:
        example: testuser
        maxLength: 50
        minLength: 3
        type: string
    required:
    - password
    - username
    type: object
  api.RegisterWithVerificationRequest:
    properties:
      code:
        example: "123456"
        type: string
      email:
        example: test@example.com
        type: string
      password:
        example: password123
        maxLength: 50
        minLength: 6
        type: string
      username:
        example: testuser
        maxLength: 50
        minLength: 3
        type: string
    required:
    - code
    - email
    - password
    - username
    type: object
  api.ReorderAIModelsRequest:
    properties:
      model_ids:
        description: 按新顺序排列的模型 ID 列表
        items:
          type: integer
        minItems: 1
        type: array
    required:
    - model_ids
    type: object
  api.RequestResetRequest:
    properties:
      email:
        type: string
    required:
    - email
    type: object
  api.ResetPasswordRequest:
    properties:
      new_password:
        minLength: 6
        type: string
      token:
        type: string
    required:
    - new_password
    - token
    type: object
  api.Response:
    properties:
      code:
        type: integer
      data: {}
      message:
        type: string
    type: object
  api.SendVerificationCodeRequest:
    properties:
      email:
        example: test@example.com
        type: string
      type:
        description: 'register: 注册, bind: 绑定邮箱'
        enum:
        - register
        - bind
        example: register
        type: string
    required:
    - email
    - type
    type: object
  api.SetAdminRequest:
    properties:
      is_admin:
        type: boolean
    type: object
  api.UpdateAIModelRequest:
    properties:
      api_key:
        minLength: 1
        type: string
      base_url:
        type: string
      name:
        maxLength: 100
        minLength: 1
        type: string
    type: object
  api.UpdateExpenseRequest:
    properties:
      amount:
        example: 99.99
        type: number
      category:
        example: 餐饮
        type: string
      description:
        example: 午餐
        type: string
      expense_time:
        example: "2024-01-15 12:30:00"
        type: string
    type: object
  api.UpdateIncomeRequest:
    properties:
      amount:
        type: number
      income_time:
        type: string
      type:
        type: string
    type: object
  api.UpdateUserFeishuRequest:
    properties:
      feishu_open_id:
        type: string
    type: object
  api.UpdateUserPasswordRequest:
    properties:
      new_password:
        minLength: 6
        type: string
    required:
    - new_password
    type: object
  api.UpdateUserStatusRequest:
    properties:
      status:
        description: Status 用户状态：active（正常）/ locked（锁定）
        enum:
        - active
        - locked
        type: string
    required:
    - status
    type: object
  api.VerifyEmailCodeRequest:
    properties:
      code:
        example: "123456"
        type: string
      email:
        example: test@example.com
        type: string
      type:
        enum:
        - register
        - bind
        example: register
        type: string
    required:
    - code
    - email
    - type
    type: object
  models.AIModel:
    properties:
      base_url:
        description: 调用地址
        type: string
      created_at:
        type: string
      id:
        type: integer
      name:
        description: 模型名称
        type: string
      sort_order:
        description: 排序序号，越小越靠前
        type: integer
      updated_at:
        type: string
    type: object
  models.Expense:
    properties:
      amount:
        type: number
      category:
        type: string
      created_at:
        type: string
      description:
        type: string
      expense_time:
        type: string
      id:
        type: integer
      updated_at:
        type: string
      user_id:
        type: integer
    type: object
  models.ExpenseCategory:
    properties:
      color:
        description: '颜色代码，如 #ef4444'
        type: string
      created_at:
        type: string
      id:
        type: integer
      name:
        type: string
      sort:
        type: integer
      updated_at:
        type: string
    type: object
  models.Income:
    properties:
      amount:
        type: number
      created_at:
        type: string
      id:
        type: integer
      income_time:
        type: string
      type:
        description: 收入类型
        type: string
      updated_at:
        type: string
      user_id:
        type: integer
    type: object
  models.IncomeCategory:
    properties:
      color:
        description: '颜色代码，如 #10b981'
        type: string
      created_at:
        type: string
      id:
        type: integer
      name:
        type: string
      sort:
        type: integer
      updated_at:
        type: string
    type: object
  models.User:
    properties:
      created_at:
        type: string
      email:
        type: string
      feishu_open_id:
        description: 飞书 open_id，用于扫码登录匹配
        type: string
      id:
        type: integer
      is_admin:
        description: 是否为管理员
        type: boolean
      status:
        description: 用户状态：locked/active
        type: string
      updated_at:
        type: string
      username:
        type: string
    type: object
host: localhost:8080
info:
  contact: {}
  description: 一个简单的记账系统 API，支持用户注册、登录、消费记录管理和数据导出功能
  title: 记账系统 API
  version: "1.0"
paths:
  /admin/ai-analysis:
    post:
      consumes:
      - application/json
      description: 选择时间范围和AI模型，对消费记录进行AI分析，SSE流式返回JSON帧（delta/done/error）。管理员可分析所有记录或指定用户的记录（通过user_id参数），非管理员只能分析自己的记录。分析结束后会保存到历史记录。
      parameters:
      - description: 分析请求（user_id字段仅管理员可用）
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AnalysisRequest'
      produces:
      - text/event-stream
      responses:
        "200":
          description: 'SSE流：data: {\"type\":\"delta\",\"content\":\"...\"}'
          schema:
            type: string
        "400":
          description: 参数错误或该时间范围内没有消费记录
          schema:
            additionalProperties: true
            type: object
        "404":
          description: AI模型不存在
          schema:
            additionalProperties: true
            type: object
      summary: AI分析消费记录（流式）
      tags:
      - 后台管理-AI分析
  /admin/ai-analysis/history:
    get:
      description: 获取AI分析历史记录，按model_id分页返回（软删除不返回）
      parameters:
      - description: AI模型ID
        in: query
        name: model_id
        required: true
        type: integer
      - description: 页码，默认1
        in: query
        name: page
        type: integer
      - description: 每页条数，默认20，最大100
        in: query
        name: page_size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回分页数据
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误
          schema:
            additionalProperties: true
            type: object
      summary: 获取AI分析历史
      tags:
      - 后台管理-AI分析
  /admin/ai-analysis/history/{id}:
    delete:
      description: 软删除指定的AI分析历史记录
      parameters:
      - description: 历史记录ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 无效的ID
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 记录不存在
          schema:
            additionalProperties: true
            type: object
      summary: 删除AI分析历史
      tags:
      - 后台管理-AI分析
  /admin/ai-chat:
    post:
      consumes:
      - application/json
      description: 选择AI模型，与AI进行对话，SSE流式返回JSON帧（delta/done/error）。结束后保存聊天记录。
      parameters:
      - description: 聊天请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AIChatRequest'
      produces:
      - text/event-stream
      responses:
        "200":
          description: 'SSE流：data: {\"type\":\"delta\",\"content\":\"...\"}'
          schema:
            type: string
        "400":
          description: 参数错误
          schema:
            additionalProperties: true
            type: object
        "404":
          description: AI模型不存在
          schema:
            additionalProperties: true
            type: object
      summary: AI聊天（流式）
      tags:
      - 后台管理-AI聊天
  /admin/ai-chat/history:
    get:
      description: 获取AI聊天历史记录，按model_id分页返回（软删除不返回）
      parameters:
      - description: AI模型ID
        in: query
        name: model_id
        required: true
        type: integer
      - description: 页码，默认1
        in: query
        name: page
        type: integer
      - description: 每页条数，默认20，最大100
        in: query
        name: page_size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回分页数据
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误
          schema:
            additionalProperties: true
            type: object
      summary: 获取AI聊天历史
      tags:
      - 后台管理-AI聊天
  /admin/ai-chat/history/{id}:
    delete:
      description: 软删除指定的AI聊天记录
      parameters:
      - description: 聊天记录ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 无效的ID
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 记录不存在
          schema:
            additionalProperties: true
            type: object
      summary: 删除AI聊天记录
      tags:
      - 后台管理-AI聊天
  /admin/ai-models:
    get:
      description: 获取系统中所有AI模型配置列表（不包含APIKey）
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回模型列表
          schema:
            additionalProperties: true
            type: object
      summary: 获取AI模型列表
      tags:
      - 后台管理-AI模型
    post:
      consumes:
      - application/json
      description: 创建新的AI模型配置，包括名称、API地址和密钥
      parameters:
      - description: AI模型信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.CreateAIModelRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 创建成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误或模型名称已存在
          schema:
            additionalProperties: true
            type: object
      summary: 创建AI模型
      tags:
      - 后台管理-AI模型
  /admin/ai-models/{id}:
    delete:
      description: 删除指定的AI模型配置（软删除）
      parameters:
      - description: AI模型ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 无效的ID
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 模型不存在
          schema:
            additionalProperties: true
            type: object
      summary: 删除AI模型
      tags:
      - 后台管理-AI模型
    get:
      description: 根据ID获取AI模型配置详情（不包含APIKey）
      parameters:
      - description: AI模型ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 无效的ID
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 模型不存在
          schema:
            additionalProperties: true
            type: object
      summary: 获取单个AI模型
      tags:
      - 后台管理-AI模型
    put:
      consumes:
      - application/json
      description: 更新指定的AI模型配置信息
      parameters:
      - description: AI模型ID
        in: path
        name: id
        required: true
        type: integer
      - description: 更新的模型信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.UpdateAIModelRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误或模型名称已存在
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 模型不存在
          schema:
            additionalProperties: true
            type: object
      summary: 更新AI模型
      tags:
      - 后台管理-AI模型
  /admin/ai-models/{id}/test:
    post:
      description: 向AI模型发送轻量测试请求，检测接口是否可用
      parameters:
      - description: AI模型ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 检测成功，接口可用
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 无效的ID
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 模型不存在
          schema:
            additionalProperties: true
            type: object
        "502":
          description: 接口不可用
          schema:
            additionalProperties: true
            type: object
      summary: 检测AI接口可用性
      tags:
      - 后台管理-AI模型
  /admin/ai-models/reorder:
    put:
      consumes:
      - application/json
      description: 根据传入的模型ID顺序更新排序，用于前端拖拽排序后保存
      parameters:
      - description: 模型ID顺序
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.ReorderAIModelsRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 排序成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误
          schema:
            additionalProperties: true
            type: object
      summary: 排序AI模型
      tags:
      - 后台管理-AI模型
  /admin/categories:
    get:
      description: 获取所有消费类别列表，支持按名称模糊搜索
      parameters:
      - description: 类别名称（模糊匹配）
        in: query
        name: name
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回类别列表
          schema:
            additionalProperties: true
            type: object
      summary: 获取消费类别列表
      tags:
      - 后台管理-消费类别
    post:
      consumes:
      - application/json
      description: 创建新的消费类别，支持设置名称、排序和颜色
      parameters:
      - description: 类别信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.CategoryCreateRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 创建成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误或类别名称已存在
          schema:
            additionalProperties: true
            type: object
      summary: 创建消费类别
      tags:
      - 后台管理-消费类别
  /admin/categories/{id}:
    delete:
      description: 软删除指定的消费类别
      parameters:
      - description: 类别ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 无效的ID
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 类别不存在
          schema:
            additionalProperties: true
            type: object
      summary: 删除消费类别
      tags:
      - 后台管理-消费类别
    put:
      consumes:
      - application/json
      description: 更新指定的消费类别信息
      parameters:
      - description: 类别ID
        in: path
        name: id
        required: true
        type: integer
      - description: 更新的类别信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.CategoryUpdateRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误或类别名称已存在
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 类别不存在
          schema:
            additionalProperties: true
            type: object
      summary: 更新消费类别
      tags:
      - 后台管理-消费类别
  /admin/current-user:
    get:
      description: 获取当前登录用户的详细信息（包括用户ID）
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
      summary: 获取当前登录用户信息
      tags:
      - 后台管理
  /admin/email-config:
    get:
      description: 获取邮件服务配置信息（邮箱地址会被部分隐藏）
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回邮件配置信息
          schema:
            additionalProperties: true
            type: object
      summary: 获取邮件配置状态
      tags:
      - 后台管理-密码重置
  /admin/expenses:
    get:
      description: 获取消费记录列表，支持分页、时间范围、类别、用户名筛选。管理员可查看所有记录并可按用户ID筛选，非管理员只能查看自己的记录。
      parameters:
      - description: 页码，默认1
        in: query
        name: page
        type: integer
      - description: 每页数量，默认20
        in: query
        name: page_size
        type: integer
      - description: 开始时间 (YYYY-MM-DD)
        in: query
        name: start_time
        type: string
      - description: 结束时间 (YYYY-MM-DD)
        in: query
        name: end_time
        type: string
      - description: 类别筛选
        in: query
        name: category
        type: string
      - description: 用户名筛选（模糊匹配）
        in: query
        name: username
        type: string
      - description: 用户ID筛选（仅管理员可用）
        in: query
        name: user_id
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回分页数据
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
      summary: 获取消费记录列表
      tags:
      - 后台管理-消费记录
    post:
      consumes:
      - application/json
      description: 创建一条新的消费记录。管理员可以为任何用户创建，非管理员只能为自己创建。
      parameters:
      - description: 消费记录信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AdminCreateExpenseRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 创建成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误或类别不存在
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
        "403":
          description: 权限不足
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 用户不存在
          schema:
            additionalProperties: true
            type: object
      summary: 创建消费记录
      tags:
      - 后台管理-消费记录
  /admin/expenses/{id}:
    delete:
      description: 删除指定的消费记录（软删除）。管理员可以删除任何记录，非管理员只能删除自己的记录。
      parameters:
      - description: 消费记录ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
        "403":
          description: 权限不足
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 记录不存在
          schema:
            additionalProperties: true
            type: object
      summary: 删除消费记录
      tags:
      - 后台管理-消费记录
    put:
      consumes:
      - application/json
      description: 更新指定的消费记录。管理员可以更新任何记录，非管理员只能更新自己的记录。
      parameters:
      - description: 消费记录ID
        in: path
        name: id
        required: true
        type: integer
      - description: 更新的消费记录信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AdminUpdateExpenseRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误或类别不存在
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
        "403":
          description: 权限不足
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 记录不存在
          schema:
            additionalProperties: true
            type: object
      summary: 更新消费记录
      tags:
      - 后台管理-消费记录
  /admin/expenses/detailed-statistics:
    get:
      description: 获取详细的消费统计数据，支持按月、按年或自定义时间范围统计，支持多个类别筛选。管理员可按用户ID筛选，非管理员只能查看自己的数据。
      parameters:
      - description: 时间范围类型：month(按月)、year(按年)、custom(自定义)
        in: query
        name: range_type
        required: true
        type: string
      - description: 当range_type=month时必填，格式：2024-01
        in: query
        name: year_month
        type: string
      - description: 当range_type=year时必填，格式：2024
        in: query
        name: year
        type: string
      - description: 当range_type=custom时必填，格式：2024-01-01
        in: query
        name: start_time
        type: string
      - description: 当range_type=custom时必填，格式：2024-12-31
        in: query
        name: end_time
        type: string
      - description: 类别筛选，多个类别用逗号分隔，如：餐饮,交通
        in: query
        name: categories
        type: string
      - description: 用户ID筛选（仅管理员可用）
        in: query
        name: user_id
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，包含总金额、总记录数、类别统计等
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
      summary: 获取详细消费统计
      tags:
      - 后台管理-统计
  /admin/export/excel:
    get:
      description: 根据时间范围导出消费记录为Excel文件。管理员可导出所有用户数据，普通用户只能导出自己的数据。
      parameters:
      - description: 开始时间 (YYYY-MM-DD)
        in: query
        name: start_time
        required: true
        type: string
      - description: 结束时间 (YYYY-MM-DD)
        in: query
        name: end_time
        required: true
        type: string
      produces:
      - application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
      responses:
        "200":
          description: Excel文件
          schema:
            type: file
        "400":
          description: 参数错误
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
      summary: 导出消费记录为Excel
      tags:
      - 后台管理-导出
  /admin/feishu/callback:
    get:
      description: 飞书授权后重定向到此地址，使用 code 换取 token 并完成登录
      parameters:
      - description: 授权码
        in: query
        name: code
        required: true
        type: string
      responses:
        "302":
          description: 重定向到登录页并携带 error 参数
      summary: 飞书授权回调
      tags:
      - 后台管理
  /admin/feishu/config:
    get:
      description: 返回前端初始化二维码所需参数，仅当飞书登录已启用时有效
      produces:
      - application/json
      responses:
        "200":
          description: 配置信息
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 飞书登录未启用
          schema:
            additionalProperties: true
            type: object
      summary: 获取飞书扫码登录配置
      tags:
      - 后台管理
  /admin/income-categories:
    get:
      description: 获取所有收入类别列表，支持按名称模糊搜索
      parameters:
      - description: 类别名称（模糊匹配）
        in: query
        name: name
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回类别列表
          schema:
            additionalProperties: true
            type: object
      summary: 获取收入类别列表
      tags:
      - 后台管理-收入类别
    post:
      consumes:
      - application/json
      description: 创建新的收入类别，支持设置名称、排序和颜色
      parameters:
      - description: 类别信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.IncomeCategoryCreateRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 创建成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误或类别名称已存在
          schema:
            additionalProperties: true
            type: object
      summary: 创建收入类别
      tags:
      - 后台管理-收入类别
  /admin/income-categories/{id}:
    delete:
      description: 软删除指定的收入类别
      parameters:
      - description: 类别ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 无效的ID
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 类别不存在
          schema:
            additionalProperties: true
            type: object
      summary: 删除收入类别
      tags:
      - 后台管理-收入类别
    put:
      consumes:
      - application/json
      description: 更新指定的收入类别信息
      parameters:
      - description: 类别ID
        in: path
        name: id
        required: true
        type: integer
      - description: 更新的类别信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.IncomeCategoryUpdateRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误或类别名称已存在
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 类别不存在
          schema:
            additionalProperties: true
            type: object
      summary: 更新收入类别
      tags:
      - 后台管理-收入类别
  /admin/incomes:
    get:
      description: 获取收入记录列表，支持分页、时间范围、类型、用户名筛选。管理员可查看所有记录并可按用户ID筛选，非管理员只能查看自己的记录。
      parameters:
      - description: 页码，默认1
        in: query
        name: page
        type: integer
      - description: 每页数量，默认20
        in: query
        name: page_size
        type: integer
      - description: 开始时间 (YYYY-MM-DD)
        in: query
        name: start_time
        type: string
      - description: 结束时间 (YYYY-MM-DD)
        in: query
        name: end_time
        type: string
      - description: 收入类型筛选
        in: query
        name: type
        type: string
      - description: 用户名筛选（模糊匹配）
        in: query
        name: username
        type: string
      - description: 用户ID筛选（仅管理员可用）
        in: query
        name: user_id
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回分页数据
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
      summary: 获取收入记录列表
      tags:
      - 后台管理-收入管理
    post:
      consumes:
      - application/json
      description: 创建一条新的收入记录。管理员可以为任何用户创建，非管理员只能为自己创建。
      parameters:
      - description: 收入信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AdminCreateIncomeRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 创建成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误或时间格式错误
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
        "403":
          description: 权限不足
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 用户不存在
          schema:
            additionalProperties: true
            type: object
      summary: 创建收入记录
      tags:
      - 后台管理-收入管理
  /admin/incomes/{id}:
    delete:
      description: 删除指定的收入记录（软删除）。管理员可以删除任何记录，非管理员只能删除自己的记录。
      parameters:
      - description: 收入记录ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 无效的ID
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 记录不存在
          schema:
            additionalProperties: true
            type: object
      summary: 删除收入记录
      tags:
      - 后台管理-收入管理
    put:
      consumes:
      - application/json
      description: 更新指定的收入记录。管理员可以更新任何记录，非管理员只能更新自己的记录。
      parameters:
      - description: 收入记录ID
        in: path
        name: id
        required: true
        type: integer
      - description: 更新的收入信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AdminUpdateIncomeRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误或时间格式错误
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
        "403":
          description: 权限不足
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 记录不存在
          schema:
            additionalProperties: true
            type: object
      summary: 更新收入记录
      tags:
      - 后台管理-收入管理
  /admin/login:
    post:
      consumes:
      - application/json
      description: 管理员使用用户名和密码登录，登录成功后设置 Cookie。只有状态为 active 的用户可以登录。
      parameters:
      - description: 登录信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AdminLoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 登录成功，返回用户信息
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 用户名或密码错误
          schema:
            additionalProperties: true
            type: object
        "403":
          description: 账号已锁定
          schema:
            additionalProperties: true
            type: object
      summary: 管理员登录
      tags:
      - 后台管理
  /admin/logout:
    post:
      description: 清除登录 Cookie，退出登录
      produces:
      - application/json
      responses:
        "200":
          description: 退出成功
          schema:
            additionalProperties: true
            type: object
      summary: 管理员退出登录
      tags:
      - 后台管理
  /admin/password/admin-reset:
    post:
      consumes:
      - application/json
      description: 管理员可以直接重置指定用户的密码，无需令牌
      parameters:
      - description: 重置密码信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AdminResetPasswordRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 密码重置成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 用户不存在
          schema:
            additionalProperties: true
            type: object
      summary: 管理员重置用户密码
      tags:
      - 后台管理-密码重置
  /admin/password/request-reset:
    post:
      consumes:
      - application/json
      description: 通过邮箱请求密码重置，系统会发送包含重置链接的邮件。为了安全，即使用户不存在也返回成功。
      parameters:
      - description: 邮箱地址
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.RequestResetRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 请求成功（无论用户是否存在）
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误
          schema:
            additionalProperties: true
            type: object
        "500":
          description: 邮件发送失败
          schema:
            additionalProperties: true
            type: object
      summary: 请求密码重置
      tags:
      - 后台管理-密码重置
  /admin/password/reset:
    post:
      consumes:
      - application/json
      description: 使用有效的重置令牌设置新密码
      parameters:
      - description: 重置密码信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.ResetPasswordRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 密码重置成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误或令牌无效
          schema:
            additionalProperties: true
            type: object
      summary: 重置密码
      tags:
      - 后台管理-密码重置
  /admin/password/send-reset-email:
    post:
      consumes:
      - application/json
      description: 管理员可以为指定用户发送密码重置邮件
      parameters:
      - description: 用户ID
        in: body
        name: request
        required: true
        schema:
          additionalProperties: true
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: 邮件发送成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误或用户未设置邮箱
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 用户不存在
          schema:
            additionalProperties: true
            type: object
        "500":
          description: 邮件发送失败
          schema:
            additionalProperties: true
            type: object
      summary: 管理员发送密码重置邮件
      tags:
      - 后台管理-密码重置
  /admin/password/verify-token:
    get:
      description: 验证密码重置令牌是否有效，返回关联的用户信息
      parameters:
      - description: 重置令牌
        in: query
        name: token
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 令牌有效，返回用户信息
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 令牌无效、已使用或已过期
          schema:
            additionalProperties: true
            type: object
      summary: 验证重置令牌
      tags:
      - 后台管理-密码重置
  /admin/statistics:
    get:
      description: 获取支出和收入的统计数据，包括总金额、总记录数、类别统计等。管理员可查看所有数据，非管理员只能查看自己的数据。
      parameters:
      - description: 开始时间 (YYYY-MM-DD)
        in: query
        name: start_time
        type: string
      - description: 结束时间 (YYYY-MM-DD)
        in: query
        name: end_time
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
      summary: 获取统计数据
      tags:
      - 后台管理-统计
  /admin/statistics/summary:
    get:
      description: 按时间范围统计支出总和与收入总和。管理员可传user_id统计指定用户，非管理员只能统计自己的数据（忽略user_id）。不传start_time/end_time则统计全部时间。
      parameters:
      - description: 开始时间 (YYYY-MM-DD)，例如 2024-01-01
        in: query
        name: start_time
        type: string
      - description: 结束时间 (YYYY-MM-DD)，例如 2024-12-31
        in: query
        name: end_time
        type: string
      - description: 用户ID（仅管理员可用）
        in: query
        name: user_id
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回支出总和和收入总和
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
      summary: 获取支出/收入汇总（后台）
      tags:
      - 后台管理-统计
  /admin/users:
    get:
      description: 获取系统中所有用户列表（包含软删除的用户）
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回用户列表
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
      summary: 获取用户列表
      tags:
      - 后台管理-用户管理
  /admin/users/{id}:
    delete:
      description: 管理员可以删除用户（软删除），不能删除自己
      parameters:
      - description: 用户ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 不能删除自己
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
        "403":
          description: 权限不足
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 用户不存在
          schema:
            additionalProperties: true
            type: object
      summary: 删除用户
      tags:
      - 后台管理-用户管理
  /admin/users/{id}/admin:
    put:
      consumes:
      - application/json
      description: 管理员可以设置或取消其他用户的管理员权限，不能取消自己的管理员权限
      parameters:
      - description: 用户ID
        in: path
        name: id
        required: true
        type: integer
      - description: 管理员权限设置
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.SetAdminRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 不能取消自己的管理员权限
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
        "403":
          description: 权限不足
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 用户不存在
          schema:
            additionalProperties: true
            type: object
      summary: 设置管理员权限
      tags:
      - 后台管理-用户管理
  /admin/users/{id}/feishu:
    put:
      consumes:
      - application/json
      description: 管理员可为用户设置 feishu_open_id，设置后该用户可通过飞书扫码登录
      parameters:
      - description: 用户ID
        in: path
        name: id
        required: true
        type: integer
      - description: 飞书 open_id
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.UpdateUserFeishuRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
        "403":
          description: 权限不足
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 用户不存在
          schema:
            additionalProperties: true
            type: object
      summary: 设置用户飞书绑定
      tags:
      - 后台管理-用户管理
  /admin/users/{id}/password:
    put:
      consumes:
      - application/json
      description: 管理员可以修改指定用户的密码
      parameters:
      - description: 用户ID
        in: path
        name: id
        required: true
        type: integer
      - description: 新密码
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.UpdateUserPasswordRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
        "403":
          description: 权限不足
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 用户不存在
          schema:
            additionalProperties: true
            type: object
      summary: 更新用户密码
      tags:
      - 后台管理-用户管理
  /admin/users/{id}/status:
    put:
      consumes:
      - application/json
      description: 管理员可将用户状态设置为 normal(active) 或 locked。只有 active 状态的用户可以登录。
      parameters:
      - description: 用户ID
        in: path
        name: id
        required: true
        type: integer
      - description: 状态信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.UpdateUserStatusRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
        "403":
          description: 权限不足
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 用户不存在
          schema:
            additionalProperties: true
            type: object
      summary: 更新用户状态
      tags:
      - 用户管理
  /admin/users/exit-impersonation:
    post:
      description: 退出模拟登录，恢复原始管理员身份
      produces:
      - application/json
      responses:
        "200":
          description: 退出模拟成功
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录或未在模拟状态
          schema:
            additionalProperties: true
            type: object
      summary: 退出模拟登录
      tags:
      - 后台管理-用户管理
  /admin/users/impersonate:
    post:
      consumes:
      - application/json
      description: 管理员可以模拟登录非管理员用户，用于查看用户视角。不能模拟其他管理员。模拟登录后，原始管理员信息会保存在 Cookie 中，可以通过退出模拟恢复。
      parameters:
      - description: 用户ID
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.ImpersonateUserRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 模拟登录成功
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 参数错误
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未登录
          schema:
            additionalProperties: true
            type: object
        "403":
          description: 权限不足或不能模拟管理员
          schema:
            additionalProperties: true
            type: object
        "404":
          description: 用户不存在
          schema:
            additionalProperties: true
            type: object
      summary: 模拟登录用户
      tags:
      - 后台管理-用户管理
  /api/v1/ai-analysis:
    post:
      consumes:
      - application/json
      description: 选择时间范围与AI模型，对当前用户在该时间范围内的消费记录进行AI分析，SSE流式返回 JSON 帧（delta/done/error）。分析结束后会保存到历史记录。
      parameters:
      - description: 分析请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AnalysisRequest'
      produces:
      - text/event-stream
      responses:
        "200":
          description: 'SSE流：data: {\"type\":\"delta\",\"content\":\"...\"}'
          schema:
            type: string
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
        "403":
          description: 账号锁定或无权限
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: AI分析（流式）
      tags:
      - AI
  /api/v1/ai-analysis/history:
    get:
      description: 获取当前用户的AI分析历史记录，按 model_id 分页返回（软删除不返回）。
      parameters:
      - description: AI模型ID
        in: query
        name: model_id
        required: true
        type: integer
      - description: 页码，默认1
        in: query
        name: page
        type: integer
      - description: 每页条数，默认20，最大100
        in: query
        name: page_size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            $ref: '#/definitions/api.Response'
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 获取AI分析历史
      tags:
      - AI
  /api/v1/ai-analysis/history/{id}:
    delete:
      parameters:
      - description: 历史记录ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
        "403":
          description: 无权限
          schema:
            $ref: '#/definitions/api.Response'
        "404":
          description: 记录不存在
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 删除AI分析历史
      tags:
      - AI
  /api/v1/ai-chat:
    post:
      consumes:
      - application/json
      description: 选择AI模型，与AI进行对话，SSE流式返回 JSON 帧（delta/done/error）。结束后保存聊天记录。
      parameters:
      - description: 聊天请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AIChatRequest'
      produces:
      - text/event-stream
      responses:
        "200":
          description: 'SSE流：data: {\"type\":\"delta\",\"content\":\"...\"}'
          schema:
            type: string
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: AI聊天（流式）
      tags:
      - AI
  /api/v1/ai-chat/history:
    get:
      description: 获取当前用户的AI聊天历史记录，按 model_id 分页返回（软删除不返回）。
      parameters:
      - description: AI模型ID
        in: query
        name: model_id
        required: true
        type: integer
      - description: 页码，默认1
        in: query
        name: page
        type: integer
      - description: 每页条数，默认20，最大100
        in: query
        name: page_size
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            $ref: '#/definitions/api.Response'
        "400":
          description: 参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 获取AI聊天历史
      tags:
      - AI
  /api/v1/ai-chat/history/{id}:
    delete:
      parameters:
      - description: 聊天记录ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
        "403":
          description: 无权限
          schema:
            $ref: '#/definitions/api.Response'
        "404":
          description: 记录不存在
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 删除AI聊天记录
      tags:
      - AI
  /api/v1/ai-models:
    get:
      description: 获取系统可用的AI模型配置列表（不包含APIKey），用于前端选择模型。
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/models.AIModel'
                  type: array
              type: object
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 获取AI模型列表
      tags:
      - AI
  /api/v1/auth/login:
    post:
      consumes:
      - application/json
      description: 用户登录获取 JWT token
      parameters:
      - description: 登录信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 登录成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  $ref: '#/definitions/api.LoginResponse'
              type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 用户名或密码错误
          schema:
            $ref: '#/definitions/api.Response'
      summary: 用户登录
      tags:
      - 认证
  /api/v1/auth/password:
    put:
      consumes:
      - application/json
      description: 修改当前用户密码
      parameters:
      - description: 密码信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.ChangePasswordRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 修改成功
          schema:
            $ref: '#/definitions/api.Response'
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 原密码错误
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 修改密码
      tags:
      - 认证
  /api/v1/auth/password/request-reset:
    post:
      consumes:
      - application/json
      description: 通过邮箱发送密码重置验证码
      parameters:
      - description: 密码重置请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AppRequestPasswordResetRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 验证码已发送
          schema:
            $ref: '#/definitions/api.Response'
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "429":
          description: 请求过于频繁
          schema:
            $ref: '#/definitions/api.Response'
      summary: App端请求密码重置
      tags:
      - 认证
  /api/v1/auth/password/reset:
    post:
      consumes:
      - application/json
      description: 使用验证码重置密码
      parameters:
      - description: 重置密码请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AppResetPasswordRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 密码重置成功
          schema:
            $ref: '#/definitions/api.Response'
        "400":
          description: 验证码错误或已过期
          schema:
            $ref: '#/definitions/api.Response'
        "500":
          description: 服务器错误
          schema:
            $ref: '#/definitions/api.Response'
      summary: App端重置密码
      tags:
      - 认证
  /api/v1/auth/password/verify-code:
    post:
      consumes:
      - application/json
      description: 验证密码重置验证码是否正确
      parameters:
      - description: 验证请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.AppVerifyResetCodeRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 验证成功
          schema:
            $ref: '#/definitions/api.Response'
        "400":
          description: 验证码错误或已过期
          schema:
            $ref: '#/definitions/api.Response'
      summary: App端验证重置验证码
      tags:
      - 认证
  /api/v1/auth/profile:
    get:
      consumes:
      - application/json
      description: 获取当前登录用户的详细信息
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.User'
              type: object
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 获取当前用户信息
      tags:
      - 认证
  /api/v1/auth/register:
    post:
      consumes:
      - application/json
      description: 创建新用户账号。注意：新注册用户默认处于“锁定(locked)”状态，需要管理员在后台将状态改为“正常(active)”后才能登录。
      parameters:
      - description: 注册信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.RegisterRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 注册成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.User'
              type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "500":
          description: 服务器错误
          schema:
            $ref: '#/definitions/api.Response'
      summary: 用户注册
      tags:
      - 认证
  /api/v1/auth/register-verified:
    post:
      consumes:
      - application/json
      description: 需要先发送验证码，验证通过后创建用户账号。注意：新注册用户默认处于“锁定(locked)”状态，需要管理员在后台将状态改为“正常(active)”后才能登录。
      parameters:
      - description: 注册信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.RegisterWithVerificationRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 注册成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.User'
              type: object
        "400":
          description: 请求参数错误或验证码错误
          schema:
            $ref: '#/definitions/api.Response'
        "500":
          description: 服务器错误
          schema:
            $ref: '#/definitions/api.Response'
      summary: 带邮箱验证的用户注册
      tags:
      - 认证
  /api/v1/auth/send-code:
    post:
      consumes:
      - application/json
      description: 发送邮箱验证码用于注册或绑定邮箱
      parameters:
      - description: 验证码请求信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.SendVerificationCodeRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 发送成功
          schema:
            $ref: '#/definitions/api.Response'
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "500":
          description: 服务器错误
          schema:
            $ref: '#/definitions/api.Response'
      summary: 发送邮箱验证码
      tags:
      - 认证
  /api/v1/auth/verify-code:
    post:
      consumes:
      - application/json
      description: 验证邮箱验证码是否正确
      parameters:
      - description: 验证请求信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.VerifyEmailCodeRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 验证成功
          schema:
            $ref: '#/definitions/api.Response'
        "400":
          description: 验证码错误或已过期
          schema:
            $ref: '#/definitions/api.Response'
      summary: 验证邮箱验证码
      tags:
      - 认证
  /api/v1/categories:
    get:
      consumes:
      - application/json
      description: |-
        获取所有可用的消费类别列表，返回完整的类别对象数组。类别按排序字段（sort）升序排列，排序相同时按ID升序排列。

        返回的每个类别对象包含以下字段：
        - id (uint): 类别唯一标识符，主键
        - name (string): 类别名称，最大长度50字符，唯一索引，必填
        - sort (int): 排序值，用于控制类别显示顺序，值越小越靠前，默认值为0
        - created_at (time.Time): 创建时间，ISO 8601格式的时间字符串
        - updated_at (time.Time): 更新时间，ISO 8601格式的时间字符串

        示例响应：
        {
        "code": 200,
        "message": "success",
        "data": [
        {
        "id": 1,
        "name": "餐饮",
        "sort": 0,
        "created_at": "2024-01-01T00:00:00Z",
        "updated_at": "2024-01-01T00:00:00Z"
        },
        {
        "id": 2,
        "name": "交通",
        "sort": 1,
        "created_at": "2024-01-01T00:00:00Z",
        "updated_at": "2024-01-01T00:00:00Z"
        }
        ]
        }
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回类别列表数组
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/models.ExpenseCategory'
                  type: array
              type: object
        "500":
          description: 服务器内部错误，查询失败时返回错误信息
          schema:
            $ref: '#/definitions/api.Response'
      summary: 获取消费类别列表
      tags:
      - 消费记录
  /api/v1/expenses:
    get:
      consumes:
      - application/json
      description: 获取当前用户的消费记录列表，支持分页和筛选
      parameters:
      - default: 1
        description: 页码
        in: query
        name: page
        type: integer
      - default: 10
        description: 每页数量
        in: query
        name: page_size
        type: integer
      - description: 类别筛选
        in: query
        name: category
        type: string
      - description: 开始时间 (2024-01-01)
        in: query
        name: start_time
        type: string
      - description: 结束时间 (2024-12-31)
        in: query
        name: end_time
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  allOf:
                  - $ref: '#/definitions/api.PageResponse'
                  - properties:
                      list:
                        items:
                          $ref: '#/definitions/models.Expense'
                        type: array
                    type: object
              type: object
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 获取消费记录列表
      tags:
      - 消费记录
    post:
      consumes:
      - application/json
      description: 创建一条新的消费记录
      parameters:
      - description: 消费记录信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.CreateExpenseRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 创建成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.Expense'
              type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 创建消费记录
      tags:
      - 消费记录
  /api/v1/expenses/{id}:
    delete:
      consumes:
      - application/json
      description: 删除指定的消费记录
      parameters:
      - description: 消费记录ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
        "404":
          description: 记录不存在
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 删除消费记录
      tags:
      - 消费记录
    get:
      consumes:
      - application/json
      description: 根据ID获取消费记录详情
      parameters:
      - description: 消费记录ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.Expense'
              type: object
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
        "404":
          description: 记录不存在
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 获取单条消费记录
      tags:
      - 消费记录
    put:
      consumes:
      - application/json
      description: 更新指定的消费记录
      parameters:
      - description: 消费记录ID
        in: path
        name: id
        required: true
        type: integer
      - description: 消费记录信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.UpdateExpenseRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.Expense'
              type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
        "404":
          description: 记录不存在
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 更新消费记录
      tags:
      - 消费记录
  /api/v1/expenses/detailed-statistics:
    get:
      consumes:
      - application/json
      description: |-
        获取消费统计信息，支持多种时间范围筛选（月、年、自定义）和多个类别筛选。返回按类别统计的数据，适合绘制饼图和柱状图。

        时间范围类型说明：
        - month: 按月统计，需要传入 year_month 参数（格式：2024-01）
        - year: 按年统计，需要传入 year 参数（格式：2024）
        - custom: 自定义时间范围，需要传入 start_time 和 end_time 参数（格式：2024-01-01）

        类别筛选说明：
        - categories: 可选的类别筛选，多个类别用逗号分隔（如：餐饮,交通），不传则统计所有类别

        返回数据说明：
        - total_amount: 总金额
        - total_count: 总记录数
        - category_stats: 按类别统计的数组，每个元素包含 category（类别名称）、total（总金额）、count（记录数）、percentage（占比百分比）
      parameters:
      - description: 时间范围类型：month（月）/year（年）/custom（自定义）
        enum:
        - month
        - year
        - custom
        in: query
        name: range_type
        required: true
        type: string
      - description: 年月（当range_type=month时必填，格式：2024-01）
        in: query
        name: year_month
        type: string
      - description: 年份（当range_type=year时必填，格式：2024）
        in: query
        name: year
        type: string
      - description: 开始时间（当range_type=custom时必填，格式：2024-01-01）
        in: query
        name: start_time
        type: string
      - description: 结束时间（当range_type=custom时必填，格式：2024-12-31）
        in: query
        name: end_time
        type: string
      - description: 类别筛选，多个类别用逗号分隔（如：餐饮,交通）
        in: query
        name: categories
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回统计数据和分类统计
          schema:
            $ref: '#/definitions/api.Response'
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 获取详细消费统计
      tags:
      - 消费记录
  /api/v1/expenses/statistics:
    get:
      consumes:
      - application/json
      description: 获取指定时间范围内的消费统计
      parameters:
      - description: 开始时间 (2024-01-01)
        in: query
        name: start_time
        type: string
      - description: 结束时间 (2024-12-31)
        in: query
        name: end_time
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 获取消费统计
      tags:
      - 消费记录
  /api/v1/export/csv:
    get:
      consumes:
      - application/json
      description: 根据时间范围导出消费记录为 CSV 文件
      parameters:
      - description: 开始时间 (2024-01-01)
        in: query
        name: start_time
        required: true
        type: string
      - description: 结束时间 (2024-12-31)
        in: query
        name: end_time
        required: true
        type: string
      produces:
      - text/csv
      responses:
        "200":
          description: CSV 文件
          schema:
            type: file
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 导出消费记录
      tags:
      - 导出
  /api/v1/export/json:
    get:
      consumes:
      - application/json
      description: 根据时间范围导出消费记录为 JSON 格式
      parameters:
      - description: 开始时间 (2024-01-01)
        in: query
        name: start_time
        required: true
        type: string
      - description: 结束时间 (2024-12-31)
        in: query
        name: end_time
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 导出成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/models.Expense'
                  type: array
              type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 导出消费记录为 JSON
      tags:
      - 导出
  /api/v1/income-categories:
    get:
      consumes:
      - application/json
      description: 获取所有可用的收入类别列表，返回完整的类别对象数组。类别按排序字段（sort）升序排列，排序相同时按ID升序排列。返回字段与消费类别一致：id、name、sort、color、created_at、updated_at。
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功，返回类别列表数组
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  items:
                    $ref: '#/definitions/models.IncomeCategory'
                  type: array
              type: object
        "500":
          description: 服务器内部错误，查询失败时返回错误信息
          schema:
            $ref: '#/definitions/api.Response'
      summary: 获取收入类别列表
      tags:
      - 收入
  /api/v1/incomes:
    get:
      description: 获取当前用户的收入列表，支持分页与筛选
      parameters:
      - default: 1
        description: 页码
        in: query
        name: page
        type: integer
      - default: 10
        description: 每页数量
        in: query
        name: page_size
        type: integer
      - description: 收入类型筛选
        in: query
        name: type
        type: string
      - description: 开始时间 (2024-01-01)
        in: query
        name: start_time
        type: string
      - description: 结束时间 (2024-12-31)
        in: query
        name: end_time
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  allOf:
                  - $ref: '#/definitions/api.PageResponse'
                  - properties:
                      list:
                        items:
                          $ref: '#/definitions/models.Income'
                        type: array
                    type: object
              type: object
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 获取收入列表
      tags:
      - 收入
    post:
      consumes:
      - application/json
      description: 创建一条新的收入记录
      parameters:
      - description: 收入信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.CreateIncomeRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 创建成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.Income'
              type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 创建收入
      tags:
      - 收入
  /api/v1/incomes/{id}:
    delete:
      description: 删除指定的收入记录
      parameters:
      - description: 收入ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 删除成功
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
        "404":
          description: 记录不存在
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 删除收入
      tags:
      - 收入
    get:
      description: 根据ID获取收入详情
      parameters:
      - description: 收入ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.Income'
              type: object
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
        "404":
          description: 记录不存在
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 获取单条收入
      tags:
      - 收入
    put:
      consumes:
      - application/json
      description: 更新指定的收入记录
      parameters:
      - description: 收入ID
        in: path
        name: id
        required: true
        type: integer
      - description: 收入信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/api.UpdateIncomeRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 更新成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  $ref: '#/definitions/models.Income'
              type: object
        "400":
          description: 请求参数错误
          schema:
            $ref: '#/definitions/api.Response'
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
        "404":
          description: 记录不存在
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 更新收入
      tags:
      - 收入
  /api/v1/statistics/summary:
    get:
      description: 按时间范围统计当前用户的支出总和与收入总和。不传 start_time/end_time 则统计全部时间。
      parameters:
      - description: 开始时间 (YYYY-MM-DD)，例如 2024-01-01
        in: query
        name: start_time
        type: string
      - description: 结束时间 (YYYY-MM-DD)，例如 2024-12-31
        in: query
        name: end_time
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 获取成功
          schema:
            allOf:
            - $ref: '#/definitions/api.Response'
            - properties:
                data:
                  $ref: '#/definitions/api.IncomeExpenseSummaryResponse'
              type: object
        "401":
          description: 未授权
          schema:
            $ref: '#/definitions/api.Response'
      security:
      - BearerAuth: []
      summary: 获取支出/收入汇总
      tags:
      - 统计
securityDefinitions:
  BearerAuth:
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
